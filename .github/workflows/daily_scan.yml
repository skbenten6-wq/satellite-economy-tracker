name: Daily Economy Scan & Email

on:
  schedule:
    # Runs at 03:30 UTC (9:00 AM IST)
    - cron: '30 3 * * *'
  workflow_dispatch: # Allows manual trigger

jobs:
  run-and-email:
    runs-on: ubuntu-latest

    steps:
      # 1. Get the code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Install Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Install Libraries
      - name: Install Dependencies
        run: |
          pip install requests matplotlib pillow

      # 4. Run your Tracker Script
      - name: Run Satellite Tracker
        env:
          SH_CLIENT_ID: ${{ secrets.SH_CLIENT_ID }}
          SH_CLIENT_SECRET: ${{ secrets.SH_CLIENT_SECRET }}
        run: python main.py
        # Ensure your main.py saves the file as 'dashboard.png'
        # I have updated the python snippet below to ensure it does this.

      # 5. Email the Result to You
      - name: Send Email with Images
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP Settings (For Gmail)
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          
          # Email Details
          subject: "üõ∞Ô∏è Daily Satellite Dashboard: GRSE & Economy"
          to: aman.nitbhopal@gmail.com
          from: "GitHub Satellite Bot"
          body: "Here is your daily satellite intelligence report. Download the attachment and upload to Gemini for analysis."
          
          # ATTACHMENT: This attaches the image generated by python
          attachments: dashboard.png
