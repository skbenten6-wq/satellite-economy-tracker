name: Daily Economy Scan (GEE)

on:
  schedule:
    # 02:30 UTC = 8:00 AM India Standard Time
    - cron: '30 2 * * *'
  workflow_dispatch:

jobs:
  run-and-email:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries
        run: |
          pip install earthengine-api geemap matplotlib pillow google-auth requests

      - name: Run Satellite Tracker
        env:
          EE_KEY: ${{ secrets.EE_KEY }}
        run: python main.py

      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: "üõ∞Ô∏è Daily India Economy Dashboard (12-Sector)"
          to: aman.nitbhopal@gmail.com
          from: "Satellite Bot"
          body: "Here is your 12-Sector Economy Dashboard for today."
          attachments: dashboard.png
